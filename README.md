# nodejs-encyclopedia-project

<!-- GitHub md is 116 characters wide. -->

>**Frontend**: https://github.com/thisisnothappening/reactjs-encyclopedia-project

Hello there! This is my web encyclopedia project. I call it Welcomepdia.
I am not planning on using or releasing this website. It's just for learning, havin fun, and showing off to employers.
I will make this README so as to simulate a more serious project. 
It will contain a description, and tutorial on how to use and deploy (even tho I know that nobody will use it).

### Description

The layout of this website is as follows:
1. The /home page, containing the header, and a list of cards, loaded from the database.
2. The /auth page. Once you are logged in, you can add or edit cards in the header of the home page.

### Tutorial

#### Configuration

##### Backend Environment Variables

I will lay out a list of all currently available variables with some values as examples:

```
PORT=8080
ACCESS_TOKEN_SECRET=secret_access_token_key
REFRESH_TOKEN_SECRET=secret_refresh_token_key
CORS_ORIGIN=http://localhost
DB_NAME=encyclopedia_test
DB_USER=root
DB_PASSWORD=admin
DB_HOST=localhost
DB_PORT=3306
DB_DIALECT=mysql
```

All these variables have to be in a .env file, in the root directory.

`PORT` and `CORS_ORIGIN` are optional. <!--Confirmed-->

At `DB_NAME` key, remove `_test` if you want a safe database, that cannot be truncated or modified.
This database is meant as production database, that you use when you deploy your server.

For `ACCESS_TOKEN_SECRET` and `REFRESH_TOKEN_SECRET`, it is recommended to use whatever string is generated by this line:
`require('crypto').randomBytes(64).toString('hex')`
(don't use the same value for both keys!)

The default value for the port is hardcoded in server.js as `8080`.
There is a default cors origin hardcoded in server.js as `http://localhost:3000`.

##### Frontend Environment Variables

There is currently only 1 env variable:

```
REACT_APP_HOST_NAME=http://localhost:8080
```

This variable specifies the server API host and port.

Basically, it's how you connect the frontend to the backend.

#### How To Run

You can choose between the following:

##### Git Clone
The instructions to this route might not be complete or accurate, so I recommend doing the other one.

>You need to install: node.js, npm, git, mysql.

1. After MySQL is installed, you need to create a new connection,
and run `CREATE DATABASE encyclopedia_test`.
2. After that, you need to clone this repository, and the frontend repository, on your computer.
After the .env configuration is complete, open a terminal,
`cd` to this directory, and run `npm install`.
Then run `npm start`, then do the same for the frontend.

##### Docker Run (recommended)

>You need to install: docker.

1. Create any directory, anywhere on your computer, then open a terminal, and `cd` into it.
Then, you have to copy the docker-compose.yml that can be found in the root directory of this repository, 
to your directory, and remove any `external: true` from the file, if there is any.
Also, your .env file has to be in the same directory as docker-compose.yml.
2. Now run `docker compose up -d` or `docker-compose up -d`, and you will get an error
saying that your database doesn't exist. So run this line:
`docker run -it --network encyclopedia-network --rm mysql mysql -h 172.19.0.2 -u root -p`
Enter your password when prompted.
Now run `CREATE DATABASE encyclopedia_test` or whatever your database name is. Then type `exit`.
If your database doesn't end in `_test`, then you also have to manually create your tables and columns.
Your network might not be on `172.19.0.2`, so run `docker inspect encyclopedia-network`, 
and check the IP in case the above `docker run` command doesn't work.
Run `docker compose down`, wait maybe 2 seconds, then run `docker compose up -d`, and it should work.

---

Now you just have to type http://localhost:3000 (or whatever your host and port is) in your browser,
and see if it's working.

#### Deployment

If you want to use the server on a AWS EC2 instance, then you have to take the following steps:
1. Make an AWS account, and create an access key and a secret access key for your user.
If your user is not root, then you will need to enable certain privileges to be able to create an EC2 instance.
Tip: Don't forget to create a Budget, to make sure you won't lose any money.
2. On the AWS website, type "Key pairs" in the search bar and click on "Key pairs", in the "Features" section.
Then create a key pair, and copy the file to your .ssh directory on your computer.
Tip: The key pair name should be the same as the one in your main.tf file, 
which is in this case `amazon_linux_vm_key`.
3. Install the AWS CLI, and the Terraform CLI on your computer.
4. Copy the /terraform directory from this repository, anywhere on your computer.
5. Open the `main.tf` file, and where it says `provider "aws"`, change the region to whatever your region is.
6. Add your user credentials, which are the access key, and secret access key:
Open a terminal, and run `aws configure`, then type your access keys in the prompts.
7. `cd` into the /terraform directory and run `terraform init`, then run `terraform apply`. 
If you want to delete everything, just run `terraform destroy`, which will also delete your EC2 instance.
8. In your terminal, ssh into the EC2 instance that you created, and then just follow the instructions
from the "Docker Run" title, but you don't need to install Docker, since it's already installed by main.tf.
